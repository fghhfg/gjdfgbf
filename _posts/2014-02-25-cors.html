---
title: "跨源资源共享(CORS)"
layout: "post"
uuid: "933857558827295393"
guid: "tag:blogger.com,1999:blog-699851730225582652.post-933857558827295393"
date: "2014-02-25 15:30:00"
updated: "2014-02-25 15:39:02"
description: 
blogger:
    siteid: "699851730225582652"
    postid: "933857558827295393"
categories: [html API]
author: 
    name: "asd"
    url: "undefined?rel=author"
    image: "http://img2.blogblog.com/img/b16-rounded.gif"
---

<div class="css-full-post-content js-full-post-content">
-<br /><h1 style="background-color: #dddfd9; background-image: url(http://www.zhangxinxu.com/wordpress/wp-content/themes/mobile_pack_base/img/radial.png); background-position: 50% 0%; background-repeat: repeat no-repeat; border-color: rgb(216, 216, 216) rgb(221, 223, 217) rgb(221, 223, 217); border-top-style: solid; border-width: 1px 0px 0px; font-size: 1.7em; margin: 0px -10px 0.3em; outline: 0px; padding: 0.3em 10px; vertical-align: baseline;">理解DOMString、Document、FormData、Blob、File、ArrayBuffer数据类型</h1><div class="metadata" style="border: 0px; clear: both; color: #8c8f6c; font-size: 0.8em; line-height: 16px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">十月 14th, 2013 by 张 鑫旭</div><div class="entry" style="border: 0px; font-size: 16px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">创建Blob对象的方法有几种，可以调用Blob构造函数，还可以使用一个已有Blob对象上的<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">slice()</code>方法切出另一个Blob对象，还可以调用<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">canvas</code>对象上的<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">toBlob</code>方法。</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">以上为MDN上官方口吻的解释。实际上，Blob是计算机界通用术语之一，全称写作：BLOB (binary large object)，表示二进制大对象。MySql/Oracle数据库中，就有一种Blob类型，专门存放二进制数据。</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">在实际Web应用中，Blob更多是图片二进制形式的上传与下载，虽然其可以实现几乎任意文件的二进制传输。</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">举个例子，使用Blob从服务器上GET某mm的图片（只要关心标红的部分）：</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; color: #333333; font-family: sans-serif; line-height: 16px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">var xhr = new XMLHttpRequest(); xhr.open("get", "mm1.jpg", true); xhr.responseType = "blob"; xhr.onload = function() { if (this.status == 200) { var blob = this.response; // this.response也就是请求的返回就是Blob对象 var img = document.createElement("img"); img.onload = function(e) { window.URL.revokeObjectURL(img.src); // 清除释放 }; img.src = window.URL.createObjectURL(blob); eleAppend.appendChild(img); } } xhr.send();</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">您可以狠狠地点击这里：<a href="http://www.zhangxinxu.com/study/201310/blob-get-image-show.html" style="color: #333333; margin: 0px; padding: 0px;" target="_blank">Blob获取图片并二进制显示demo</a></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">我们查看demo页面这个mm图片元素，会发现其URL地址既不是传统HTTP，也不是Base64 URL，而是Blob形式~如下截图示意：</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"><img alt="图片blob地址示意" src="http://www.zhangxinxu.com/wordpress/wp-content/plugins/wordpress-mobile-pack/plugins/wpmp_transcoder/c/422b502f7261368be715d4004207465b.124.18.png" style="background-color: transparent; border: 0px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;" /></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"><img alt="demo页面图片的blob格式的URL" src="http://www.zhangxinxu.com/wordpress/wp-content/plugins/wordpress-mobile-pack/plugins/wpmp_transcoder/c/b9f721358ac447d896e30694fd201c7d.124.74.png" style="background-color: transparent; border: 0px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;" /></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">这就是Blob在Web开发中非常重要的一个功能——创建Blob网址。上述代码涉及XMLHttpRequest 2一些重要知识点，以及<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">window.URL</code>相关技术，都是可以深入挖掘学习的部分，但，不是本文重点，以后有机会会细致阐述。</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">但是，并不是所有的图片都能以Blob形式请求，因为，毕竟是Ajax请求嘛，还是有一定的跨域限制。<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">XMLHttpRequest 2</code>虽然支持跨源资源共享(CORS)，但是，还是需要对<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Access-Control-Allow-Origin</code>的设置，允许来自那个域名的这类请求，例如，允许本人的站点Blob请求你服务器上的图片资源，你可以设置：</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; color: #333333; font-family: sans-serif; line-height: 16px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Access-Control-Allow-Origin: http://zhangxinxu.com</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">要允许任何域向您提交请求，可以设置：</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; color: #333333; font-family: sans-serif; line-height: 16px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Access-Control-Allow-Origin: *</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">我们都知道CSS3的<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">font-face</code>属性，在Firefox浏览器下，如果字体文件跨域（包括跨子域），是显示不出来的，也是通过</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; color: #333333; font-family: sans-serif; line-height: 16px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Access-Control-Allow-Origin: *</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">设置解决。其实，本质是一样的。</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">由于权限原因，我的个人站点无法配置<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Access-Control-Allow-Origin</code>，我测试了下，新浪微博的图片是无法二进制请求的，不过我的前东家，<a href="http://www.xiaomishu.com/" style="color: #333333; margin: 0px; padding: 0px;">xiaomishu.com</a>的图片都是可以Ajax请求并Blob显示的，悄悄告诉大家，是我当初动的手脚，(*^__^*) 嘻嘻……</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"><span style="background-color: transparent; border: 0px; font-weight: bolder; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">属性</span></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">Blob对象有两个属性，参见下表：</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">属性名</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">类型</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">描述</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"><span style="background-color: transparent; border: 0px; font-weight: bolder; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">size</span></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">unsigned long long(表示可以很大的数值)</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">Blob对象中所包含数据的大小。字节为单位。&nbsp;<span style="background-color: transparent; border: 0px; font-weight: bolder; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">只读。</span></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"><span style="background-color: transparent; border: 0px; font-weight: bolder; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">type</span></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">DOMString</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">一个字符串，表明该Blob对象所包含数据的MIME类型。例如，上demo图片MIME类似就是”<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">image/jpeg</code>“. 如果类型未知，则该值为空字符串。<span style="background-color: transparent; border: 0px; font-weight: bolder; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">只读。</span></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">今天在微博上看到一个表单提交之前判断文件大小并作阻止的tip，实际上，就是使用的Blob对象的<code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">size</code>属性。</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"><span style="background-color: transparent; border: 0px; font-weight: bolder; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">构造函数</span></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">与FormData对象类似，Blob也有一个构造函数用法。语法如下：</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; color: #333333; font-family: sans-serif; line-height: 16px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Blob Blob( [可选] Array parts, [可选] BlobPropertyBag properties );</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">例如：</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; color: #333333; font-family: sans-serif; line-height: 16px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">var myBlob= new Blob(arrayBuffer);</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;">其中，两个参数的含义是：</div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div><dt style="background-color: #f2f4ed; border: 0px; color: #333333; font-family: sans-serif; line-height: 16px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><code style="background-color: transparent; border: 0px; font-size: 13px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">parts</code></dt><div style="background-color: #f2f4ed; border: 0px; clear: both; color: #333333; font-family: sans-serif; line-height: 20px; margin-bottom: 0.8em; margin-top: 0.2em; outline: 0px; padding: 0px; vertical-align: baseline;"></div></div>-
</div>
